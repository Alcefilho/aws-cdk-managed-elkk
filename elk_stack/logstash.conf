## inputs from Amazon Managed Kafka
input {
  kafka {
    bootstrap_servers => "$kafka_brokers"
    topics => "$elk_topic"
    codec => "json"
    tags => ["$elk_topic"]
    }
}
## filter to tidy up 
filter {
    grok {
        match => { "message" => "%{COMMONAPACHELOG}" }
    }  
}
## output to Amazon Elasticsearch Service
output {
    amazon_es {
        hosts => [ "$es_endpoint" ]
        region => "$elk_region"
        index => "$elk_topic-%{+YYYY.MM.dd}"
        codec => "json"
    }
## output to s3
    s3 {
        region => "$elk_region"
        bucket => "$s3_bucket"
        size_file => 2048
        time_file => 5
        codec => "json"
        prefix => "$elk_topic/%{+YYYY}/%{+MM}/%{+dd}"
    }
}